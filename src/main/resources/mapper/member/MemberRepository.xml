<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="com.ssafy.priends.domain.member.mapper.MemberMapper">

	<select id="emailCheckMember" parameterType="String">
		select count(id)
		from members
		where email = #{memberEmail}
	</select>
	
	<!-- 회원가입  -->
	<!-- ID값은 AUTO_INCREMENT로 생성된 PK값이므로 -->
	<!-- useGeneratedKeys와 keyProperty 속성을 사용하여 회원가입 이후 해당 속성을 바로 사용 가능 -->
	<insert id="signUpMember" parameterType="memberDto" useGeneratedKeys="true" keyProperty="id">
    	insert into members (email, password, name, status, alarm, role)
    	values (#{email}, #{password}, #{name}, #{status}, #{alarm}, #{role})
	</insert>

	<!-- 회원정보 수정 -->
	<update id="updateMember" parameterType="memberDto">
		update members set password = #{password}, name = #{name}, alarm = #{alarm}
		where id = #{id}
	</update>

	<!-- 회원정보 조회-->
	<select id="getMember" parameterType="Long" resultType="memberGetDto">
		select email, name, alarm
		from members
		where id = #{id}
	</select>

	<!-- 회원 탈퇴 (회원정보 삭제하면 다른 테이블과 외래키로 묶여있여서 삭제는 안하고 회원탈퇴 여부를 나타내는 컬럼인 status 상태만 변경 -->
	<update id="deleteMember" parameterType="Long">
		update members set status = true
		where id = #{id}
	</update>

	<!-- 이메일을 통한 로그인 시 해당 회원 고유 아이디(PK) 가져오기 -->
	<!-- 나중에 수정해줘야함! (password 부분 빼고 service단에서 passwordEncoder로 확인하기 -->
	<select id="loginMember" parameterType="memberLoginRequestDto" resultType="memberInfoDto">
		select id, email, name, alarm, role
		from members
		where email = #{email}
		and password = #{password}
	</select>


	<!-- 비밀번호 찾기  -->
	<!-- 나중에 수정해줘야함! (지금은 비밀번호 찾기지만 임시비밀번호 이메일로 발송하는 기능으로 수정 예정 -->
	<select id="getPasswordMember" parameterType="Long">
 		select password
 		from members
 		where id = #{id}
 	</select>
</mapper>